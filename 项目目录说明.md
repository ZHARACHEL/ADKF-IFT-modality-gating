# 项目目录与文件作用说明（中文版）

本文档概述 `ADKF-IFT` 项目的目录结构与主要文件作用，帮助快速理解如何查找、运行与扩展代码。

## 根目录

- `README.md`：项目英文说明，含 ADKF-IFT 方法简介、FS-Mol 使用指南与命令示例。
- `readme（中文版）.md`：`README.md` 的中文翻译版，便于中文读者查阅。
- `LICENSE`：许可声明。`datasets/` 下数据遵循 CC BY-SA 3.0，其余代码遵循 MIT 许可。
- `ADKF-IFT.pdf`：论文或项目相关 PDF。
- `CODE_OF_CONDUCT.md`、`SECURITY.md`、`SUPPORT.md`：行为准则、安全与支持政策文件。
- `.gitignore`、`.gitmodules`：Git 配置与子模块配置。
- `.flake8`、`pyproject.toml`：代码风格与格式化配置（`black`、`flake8`）。
- `azure-pipelines.yml`：CI/CD 流水线配置。

## 数据与可视化

- `datasets/`：FS-Mol 数据集相关的清单与目标信息。
  - `fsmol-0.1.json`：默认任务列表（train/valid/test 任务 ID）。
  - `entire_train_set.json`：可选，包含更完整的训练任务列表。
  - `targets/`：目标蛋白与任务的元数据（`train_proteins.csv`、`test_proteins.csv`、`target_info.csv`）。

- `visualize_results/`：论文结果的原始汇总与可视化笔记本。
  - `ADKF-IFT/`、`CNP/`、`DKL/`、`DKT/`、`GNN-MT/`、`GP-ST/`、`MAT/`、`PAR/`、`RF/`：各模型的分类/回归结果汇总 `*_summary.csv`。
  - `ablation_models/`：消融实验结果汇总。
  - `plots/`：可视化图表（分类与回归的盒图、对比图等）。
  - `visualize_*.ipynb`：Jupyter 笔记本，用于生成或复现图表。

- `baselines/`：FS-Mol 原始基线结果与图表。
  - `plots/` 及若干 `*_summary.csv`：多种基线（如 GNN-MT、MAML、PN、MAT、kNN、RF）的结果摘要与图像。

## FS-Mol 主要代码（核心目录）

- `fs_mol/`：在 FS-Mol 基准上运行 ADKF-IFT（ADKT）、DKL、DKT、CNP、GNN-MT、MAML、PAR、PN 等模型的核心实现与脚本。

### 训练与测试脚本（入口）

- 根目录脚本（均在 `fs_mol/` 下）：
  - `adaptive_dkt_train.py`、`adaptive_dkt_test.py`：ADKT 的训练与评估入口（分类/回归通过参数控制）。
  - `adaptive_dkt_vgp_train.py`、`adaptive_dkt_vgp_test.py`：变分高斯过程版本 ADKT 的训练与评估。
  - `* _walltime.py`：测量适配/推理耗时的脚本（如 `adaptive_dkt_walltime.py`）。
  - 其它模型对应的 `*_train.py`、`*_test.py`：如 `dkt_*`、`dkl_*`、`cnp_*`、`maml_*`、`multitask_*`、`par_*`、`protonet_*`、`gpst_test.py` 等。
  - `baseline_test.py`、`baseline_numeric_test.py`：单任务基线（kNN、随机森林等）的评估入口，`baseline_numeric_test.py` 用于数值标签回归基线。
  - `compute_stats.py`：结果统计相关工具脚本。

### 模型定义

- `fs_mol/models/`：各模型的 PyTorch 实现或适配层。
  - `abstract_torch_fsmol_model.py`：统一的抽象模型接口，用于在 FS-Mol 框架中接入新模型。
  - `adaptive_dkt.py`、`adaptive_dkt_vgp.py`：ADKT 与其 VGP 变体的模型定义。
  - `dkt.py`、`dkl.py`、`cnp.py`、`mat.py`、`par.py`、`protonet.py`、`gnn_multitask.py`：其它模型的实现或封装。
  - `metalearning_graph_binary_classification.py`：图二分类的元学习模型基类或工具。

### 模块与组件（模型积木）

- `fs_mol/modules/`：通用网络组件。
  - `gnn.py`：图神经网络结构定义（层、消息传递等）。
  - `graph_feature_extractor.py`：将图/分子结构转换为特征的提取器。
  - `graph_readout.py`：图级读出/聚合操作。
  - `mlp.py`：多层感知机模块。

### 数据访问与任务抽象

- `fs_mol/data/`：FS-Mol 数据的读取、批处理与任务抽象。
  - `fsmol_dataset.py`：加载数据目录，构建任务数据集的核心类。
  - `fsmol_task.py`、`fsmol_task_sampler.py`：任务与任务采样逻辑（元学习支持集/查询集的划分）。
  - `fsmol_batcher.py`：批处理与迭代器封装。
  - `file_reader_iterable.py`：基于文件的迭代读取工具。
  - `cnp.py`、`dkt.py`、`maml.py`、`mat.py`、`multitask.py`、`protonet.py`：各方法的数据管线适配。

### 评估与绘图

- `fs_mol/plotting/`：评估结果收集与可视化辅助。
  - `collect_eval_runs.py`：根据评估输出目录收集与汇总各任务的评估结果（分类/回归）。
  - `utils.py`：绘图与结果处理工具。

### 预处理（可选）

- `fs_mol/preprocessing/`：从原始化学数据到 FS-Mol 格式的清洗与特征化流程。
  - `featurisers/`：特征生成、图构建与 RDKit 辅助工具。
  - `utils/`：清洗、数据库访问、保存、标准化、并行等通用工具与配置（含 `config.ini`）。
  - `clean.py`、`featurize.py`、`initial_query.py`、`query.py`：完整的数据清洗与特征化管线的脚本化入口。
  - `README.preprocess.md`：预处理流程文档与说明。
  - `test/`：针对数据清洗与特征化的测试样例与单元测试。

### 通用工具

- `fs_mol/utils/`：训练、评估、日志、度量指标等的通用工具函数。
  - `adaptive_dkt_utils.py`、`adaptive_dkt_vgp_utils.py`：ADKT 与 ADKT-VGP 的训练/评估工具与配置。
  - `metrics.py`、`metric_logger.py`、`logging.py`：度量与日志记录。
  - `cli_utils.py`、`torch_utils.py`：CLI 与 PyTorch 通用辅助。
  - `*_utils.py`：各模型方法的训练/评估/推理辅助函数（如 `dkt_utils.py`、`cnp_utils.py`、`par_utils.py` 等）。
  - `gp_utils.py`、`cauchy_hypergradient*.py`：高斯过程与超梯度相关工具。
  - `test_utils.py`：统一的评估 CLI 解析与测试运行搭建。

## MoleculeNet 实验代码

- `MoleculeNet/`：在 MoleculeNet 数据集上运行 ADKF-IFT 与对比方法的代码与脚本。
  - `chem_lib/`：化学数据/模型库。
    - `datasets/`：数据加载与批处理（`loader.py`、`batch.py`、`samples.py`）。
    - `models/`：模型与训练器（`adkf_model.py`、`adkfift_trainer.py`、`maml.py`、`relation.py`、`trainer.py` 等）。
    - `model_gin/`：预训练的 GNN 权重（`.pth` 文件）。
    - `utils.py`：通用工具。
  - `data/`：数据准备脚本（如 `splitdata.py`）。
  - `README.md`：MoleculeNet 子项目说明。
  - `main.py`、`main_adkf.py`、`test_adkf.py`：训练/测试入口脚本。
  - `parser.py`、`adkf_parser.py`：命令行参数解析。
  - `example_script_train_adkf-ift.sh`、`script_train.sh`：示例运行脚本（bash）。

## 贝叶斯优化与域外设计实验

- `bayes_opt/`：四类代表性域外分子设计实验（预测与贝叶斯优化）的代码与笔记本。
  - 数据集子目录：`antibiotics/`、`covid_moonshot/`、`dockstring/`、`organic_photovoltaics/`，包含对应数据文件与若干 `*_ei.ipynb`（不同模型的期望提升实验）。
  - `predictive_performance/`：不同模型预测性能的脚本化比较（`adkt.py`、`cnp.py`、`dkt.py`、`gnnmt.py`、`gpst.py`、`mat.py`、`par.py`、`protonet.py`，以及 `predictive.sh`）。
  - `bo_utils.py`：贝叶斯优化相关工具函数。

## 其它说明

- `.idea/`：IDE 项目配置（JetBrains 系列），与运行代码无关。
- 运行入口优先参考 `fs_mol/` 下的 `*_train.py` 与 `*_test.py` 脚本；在 MoleculeNet 上的实验请参考 `MoleculeNet/README.md` 与 `example_script_train_adkf-ift.sh`。
- 可视化与结果复现可使用 `visualize_results/` 中的笔记本与汇总 CSV。

## 常见使用路径

- 在 FS-Mol 上进行 ADKT 训练与评估：参考 `README.md` 与 `readme（中文版）.md` 中的命令示例。
- 收集评估结果：使用 `fs_mol/plotting/collect_eval_runs.py` 指向对应的输出目录。
- 扩展新模型：遵循 `fs_mol/models/abstract_torch_fsmol_model.py` 的接口，在 `fs_mol/models/` 与 `fs_mol/modules/` 中新增实现与组件。